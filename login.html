<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„ÙƒÙˆØ±Ø³ â€” Ø¯Ø®ÙˆÙ„ & ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª | Ø­Ù…Ø§ÙŠØ© Ù‚ØµÙˆÙ‰ + Ø³Ø§Ø¹Ø©</title>

<!-- Ø®Ø· -->
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet" />

<!-- CSP Ùˆ Permissions-Policy (ÙŠÙØ¶Ù‘Ù„ ØªÙØ¹ÙŠÙ„Ù‡Ù… Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ± Ù„Ù„Ù‡ÙŠØ¯Ø±) -->
<meta http-equiv="Content-Security-Policy" content="default-src 'self'; media-src 'self' blob: data:; img-src 'self' data:; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src https://fonts.gstatic.com; script-src 'self' 'unsafe-inline'; frame-ancestors 'none'; upgrade-insecure-requests">
<meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=(), autoplay=(), screen-wake-lock=()">

<style>
  :root{
    --ink:#0b1620;
    --bg:#0a0f14;
    --card:#0e151d;
    --muted:#8aa0b4;
    --brand1:#00d38f; /* Ø£Ø®Ø¶Ø± ÙÙŠØ±ÙˆØ²ÙŠ */
    --brand2:#ff8c00; /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
    --accent:#59afff; /* Ø£Ø²Ø±Ù‚ Ø®ÙÙŠÙ */
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family:'Cairo',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,'Noto Sans',sans-serif;
    background: radial-gradient(1200px 800px at 10% -20%, rgba(0,211,143,.12), transparent 60%),
                radial-gradient(900px 600px at 110% 120%, rgba(255,140,0,.12), transparent 55%),
                linear-gradient(180deg,#0b1117 0%, #0a0f14 45%, #0a0f14 100%);
    color:#e9f3fb;
    overflow-x:hidden;
    user-select:none; -webkit-user-select:none; -webkit-touch-callout:none;
  }
  ::selection{background:transparent}

  /* Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ */
  .topbar{position:sticky; top:0; z-index:50; backdrop-filter:blur(10px);
    background:linear-gradient(180deg, rgba(15,22,30,.85), rgba(15,22,30,.65));
    border-bottom:1px solid rgba(255,255,255,.06);
  }
  .topwrap{max-width:1250px; margin:auto; padding:10px 16px; display:flex; align-items:center; gap:10px; justify-content:space-between}
  .brand{display:flex; align-items:center; gap:12px; font-weight:900}
  .brand .dot{width:12px; height:12px; border-radius:50%; background:linear-gradient(135deg,var(--brand1),var(--brand2)); box-shadow:0 0 12px rgba(0,211,143,.8)}
  .brand span{letter-spacing:.3px}
  .clock{font-weight:900; min-width:184px; text-align:center; color:#cde3f7}
  .actionsbar{display:flex; align-items:center; gap:8px}
  .btn{appearance:none; border:0; cursor:pointer; font-weight:800; letter-spacing:.2px; border-radius:12px; padding:10px 14px; transition:.25s}
  .btn.ghost{background:#101a23; color:#dff3ff; border:2px solid rgba(255,255,255,.08)}
  .btn.ghost:hover{transform:translateY(-1px)}
  .btn.primary{color:#052013; background:linear-gradient(135deg,var(--brand1), var(--brand2)); box-shadow:0 8px 24px rgba(0,211,143,.22)}
  .btn.primary:hover{transform:translateY(-1px)}

  /* Toast */
  .toast{position:fixed; top:18px; right:18px; padding:12px 16px;
    background:linear-gradient(135deg,var(--brand1),var(--brand2));
    color:#02110a; border-radius:14px; box-shadow:0 10px 30px rgba(0,0,0,.35);
    opacity:0; transform:translateY(-10px) scale(.95); transition:.35s; z-index:60; font-weight:900}
  .toast.show{opacity:1; transform:translateY(0) scale(1)}

  /* Ø­Ø¨ÙŠØ¨Ø§Øª Ø·Ø§ÙŠØ±Ø© (ÙƒØ§Ù†ÙØ§Ø³) */
  .stars{position:fixed; inset:0; z-index:0; pointer-events:none; opacity:.7}
  .floaty{position:fixed; inset:0; pointer-events:none; z-index:1}
  .orb{position:absolute; width:360px; height:360px; border-radius:50%; filter:blur(40px); opacity:.25; mix-blend-mode:screen; animation:drift 24s linear infinite}
  .orb.g{background:radial-gradient(circle at 30% 30%, var(--brand1), transparent 60%)}
  .orb.o{background:radial-gradient(circle at 70% 70%, var(--brand2), transparent 60%)}
  .orb.b{background:radial-gradient(circle at 40% 40%, var(--accent), transparent 60%)}
  .orb.p1{top:8%; right:-8%; animation-duration:28s}
  .orb.p2{bottom:-12%; left:-6%; animation-duration:32s}
  .orb.p3{top:36%; left:30%; animation-duration:38s}
  @keyframes drift{0%{transform:translate(0,0) rotate(0)} 50%{transform:translate(48px,-24px) rotate(120deg)} 100%{transform:translate(0,0) rotate(360deg)}}

  /* Ø´Ø§Ø´Ø©/ÙƒØ±ÙˆØª */
  .shell{min-height:100%; display:grid; place-items:center; padding:24px; position:relative; z-index:2}
  .card{
    width:min(480px, 96vw);
    background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    border-radius:22px; backdrop-filter:blur(14px);
    border:1px solid rgba(255,255,255,.08);
    box-shadow:0 30px 80px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.06);
    overflow:hidden; transform:translateY(10px); animation:pop .7s cubic-bezier(.2,.9,.2,1) .1s forwards
  }
  @keyframes pop{to{transform:none}}
  .card-head{position:relative; padding:26px 24px 18px; text-align:center; color:#e9f3fb;
    background:
      radial-gradient(220px 220px at 8% 0%, rgba(0,211,143,.25),transparent 60%),
      radial-gradient(220px 220px at 92% 0%, rgba(255,140,0,.25),transparent 60%),
      linear-gradient(180deg, #131c27, #0f1720);
    border-bottom:1px solid rgba(255,255,255,.06)
  }
  .card-head h1{margin:0; font-size:clamp(20px,3.8vw,28px); font-weight:900; letter-spacing:.3px}
  .card-head p{margin:.35rem 0 0; opacity:.9; font-weight:700; color:#b9d1e6}
  .ribbons{position:absolute; inset:auto 0 -18px 0; height:36px; display:flex; gap:6px; justify-content:center; filter:drop-shadow(0 6px 10px rgba(0,0,0,.35))}
  .rib{width:88px; height:36px; border-radius:10px; background:linear-gradient(135deg,#101a23,#0d141c); border:1px solid rgba(255,255,255,.06); transform:skewX(-18deg)}

  .card-body{padding:22px}
  .label{font-size:14px; font-weight:800; color:#bfe8ff; margin-bottom:6px; display:block}
  .input{
    width:100%; padding:14px 14px; border-radius:14px; border:2px solid rgba(255,255,255,.08);
    outline:none; background:#0e151d; color:#dff3ff; font-size:16px; transition:.25s; user-select:auto; -webkit-user-select:auto;
    box-shadow:inset 0 0 0 1px rgba(0,0,0,.35)
  }
  .input:focus{ border-color:var(--brand1); box-shadow:0 0 0 4px rgba(0,211,143,.12)}
  .actions{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-top:12px}
  .helper{font-size:13px; color:#ff6969; min-height:20px; margin-top:8px; font-weight:800}

  /* Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ */
  #app{display:none; opacity:0}
  .app-content{max-width:1250px; margin:18px auto 60px; padding:0 16px}
  .hdr-line{display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px}
  .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:16px}
  .col{grid-column:span 12}
  @media (min-width:760px){ .col{grid-column:span 6} }
  @media (min-width:1180px){ .col{grid-column:span 4} }

  .vcard{position:relative; border-radius:18px; overflow:hidden; background:linear-gradient(180deg,#0f1720,#0c131b);
    border:1px solid rgba(255,255,255,.08); box-shadow:0 12px 26px rgba(0,0,0,.45)}
  .vhead{padding:12px 14px; font-weight:900; color:#bfe8ff; display:flex; align-items:center; justify-content:space-between; background:linear-gradient(90deg,#0c131b,#0f1720)}
  .vplayer{position:relative; background:#000}
  .video{width:100%; height: clamp(220px, 52vw, 560px); display:block; background:#000}

  /* ÙˆÙˆØªØ§Ø±Ù…Ø§Ø±Ùƒ (Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙ‚Ø·) */
  .wm{pointer-events:none; position:absolute; inset:0}
  .tag{position:absolute; font-weight:900; font-size: clamp(14px, 3.6vw, 22px); color: rgba(255,255,255,.92); text-shadow: 0 2px 10px rgba(0,0,0,.55); user-select:none}

  /* Ø´Ø¨ÙƒØ© Ø´Ø¨Ù‡ Ø´ÙØ§ÙØ© Ø§Ø®ØªÙŠØ§Ø±ÙŠØ© */
  .wm-tiles{position:absolute; inset:0; pointer-events:none; opacity:.06; background-size:220px 120px; background-repeat:repeat; mix-blend-mode:overlay}

  /* Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø®ØµØµØ© */
  .controls{
    position:relative; display:flex; align-items:center; gap:10px; padding:10px; background:linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,.55));
    border-top:1px solid rgba(255,255,255,.08)
  }
  .cbtn{appearance:none; border:0; border-radius:10px; padding:9px 12px; font-weight:900; cursor:pointer;
    background:#0d141c; color:#cfe6fb; border:1px solid rgba(255,255,255,.08)}
  .cbtn:hover{transform:translateY(-1px)}
  .range{flex:1; appearance:none; height:8px; border-radius:10px; background:#1a2a39; outline:none}
  .range::-webkit-slider-thumb{appearance:none; width:16px; height:16px; border-radius:50%; background:linear-gradient(135deg,var(--brand1),var(--brand2)); border:0}
  .time{min-width:96px; text-align:center; font-weight:900; color:#bfe8ff}

  /* Ø´Ø§Ø´Ø© Ù‚ÙÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø·Ø±Ø¯ */
  .lock{position:fixed; inset:0; background:rgba(0,0,0,.88); color:#fff; display:none; place-items:center; z-index:80}
  .lock .box{background:#101820; border:1px solid #2a3a4a; padding:24px; border-radius:16px; text-align:center; max-width:460px}

  /* ØªØ£Ø«ÙŠØ± Ø­Ù„Ù‚Ø© Ø¯Ø®ÙˆÙ„ */
  .gate{position:fixed; inset:0; pointer-events:none; z-index:40; display:none}
  .ring{position:absolute; inset:0; margin:auto; width:160vmax; height:160vmax; border-radius:50%;
    background:radial-gradient(circle, rgba(255,255,255,.0) 40%, rgba(0,211,143,.28) 41%, rgba(255,140,0,.3) 43%, rgba(255,255,255,0) 46%);
    animation: boom .9s ease-out forwards }
  @keyframes boom{ 0%{ transform:scale(.02); opacity:1 } 100%{ transform:scale(1.1); opacity:0 } }

  /* Ø±ÙˆØ§Ø¨Ø·/Ù†ØµÙˆØµ Ø«Ø§Ù†ÙˆÙŠØ© */
  .muted{color:var(--muted); font-weight:700; opacity:.85}
</style>
</head>
<body>

<!-- ÙƒØ§Ù†ÙØ§Ø³ Ù†Ø¬ÙˆÙ… Ø·Ø§ÙŠØ±Ø© -->
<canvas class="stars" id="stars" aria-hidden="true"></canvas>

<!-- Ø¹Ù†Ø§ØµØ± Ø®Ù„ÙÙŠØ© Ø·Ø§ÙŠØ±Ø© -->
<div class="floaty" aria-hidden="true">
  <div class="orb g p1"></div>
  <div class="orb o p2"></div>
  <div class="orb b p3"></div>
</div>

<div class="toast" id="toast">ğŸ”’ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø¤Ù…Ù‘Ù†</div>

<!-- Ø´Ø±ÙŠØ· Ø¹Ù„ÙˆÙŠ -->
<div class="topbar" id="topbar">
  <div class="topwrap">
    <div class="brand"><span class="dot"></span><span>Ù…Ù†ØµØ© Ø§Ù„ÙƒÙˆØ±Ø³ (Ø­Ù…Ø§ÙŠØ© Ù‚ØµÙˆÙ‰)</span></div>
    <div class="clock" id="clock">--:--:--</div>
    <div class="actionsbar">
      <button class="btn ghost" id="backBtn" title="Ø±Ø¬ÙˆØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©">â¬…ï¸ Ø±Ø¬ÙˆØ¹</button>
      <button class="btn primary" id="panicBtn" title="Ø®Ø±ÙˆØ¬ ÙÙˆØ±ÙŠ">ğŸš¨ Ø®Ø±ÙˆØ¬ ÙÙˆØ±ÙŠ</button>
    </div>
  </div>
</div>

<div class="gate" id="gate"><div class="ring"></div></div>

<!-- Ø´Ø§Ø´Ø© Ù‚ÙÙ„ -->
<div class="lock" id="lock">
  <div class="box">
    <h2>ğŸš« ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¬Ù„Ø³Ø©</h2>
    <p id="lockMsg">Ù„Ù‚Ø¯ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬Ùƒ Ø¨Ø³Ø¨Ø¨ Ù…Ø­Ø§ÙˆÙ„Ø© ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§.</p>
  </div>
</div>

<!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<main class="shell" id="login">
  <section class="card" role="dialog" aria-labelledby="title">
    <header class="card-head">
      <h1 id="title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒÙˆØ±Ø³</h1>
      <p>Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆØ§Ø¨Ø¯Ø£ Ø§Ù„ØªØ¹Ù„Ù… âœ¨</p>
      <div class="ribbons" aria-hidden="true">
        <div class="rib"></div><div class="rib"></div><div class="rib"></div>
      </div>
    </header>
    <div class="card-body">
      <label class="label" for="u">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
      <input class="input" id="u" autocomplete="username" inputmode="text" placeholder="Ù…Ø«Ø§Ù„: dr2025001" />

      <label class="label" for="p">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
      <input class="input" id="p" type="password" autocomplete="current-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />

      <div class="actions">
        <button class="btn primary" id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
        <button class="btn ghost" id="clearBtn" title="Ù…Ø³Ø­ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª">Ù…Ø³Ø­</button>
      </div>
      <div class="helper" id="err"></div>

      <div style="display:flex;gap:10px;justify-content:center;margin-top:6px">
        <small class="muted">Ù…Ø­Ù…ÙŠ â€” Ø£ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© Ù†Ø³Ø®/ØªØµÙˆÙŠØ±/Ø£Ø¯ÙˆØ§Øª Ù…Ø·ÙˆØ± = Ø®Ø±ÙˆØ¬ ÙÙˆØ±ÙŠ</small>
      </div>
    </div>
  </section>
</main>

<!-- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¹Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
<section id="app">
  <div class="app-content">
    <div class="hdr-line">
      <div><strong id="who"></strong></div>
      <div style="display:flex;gap:8px">
        <button class="btn ghost" id="logoutBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
      </div>
    </div>
    <div class="grid" id="videos"></div>
  </div>
</section>

<script>
/* ======================== Ø¨ÙŠØ§Ù†Ø§Øª Ø£Ø³Ø§Ø³ÙŠØ© ======================== */

// 1) Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† (Ù…Ø«Ø§Ù„ â€” Ø¹Ø¯Ù‘Ù„Ù‡Ø§ Ù„Ùˆ Ø¹Ø§ÙŠØ²)
const users = [
  { username: "dr2025001", password: "QK472" },
  { username: "dr2025002", password: "HB915" },
  { username: "dr2025003", password: "MT648" },
  { username: "dr2025004", password: "ZW183" },
  { username: "dr2025005", password: "LC592" },
  { username: "dr2025006", password: "FD706" },
  { username: "dr2025007", password: "AX354" },
  { username: "dr2025008", password: "VE801" },
  { username: "dr2025009", password: "JP627" },
  { username: "dr2025010", password: "RY548" },
  { username: "dr2025011", password: "NU269" },
  { username: "dr2025012", password: "TB940" },
  { username: "dr2025013", password: "GK731" },
  { username: "dr2025014", password: "WM825" },
  { username: "dr2025015", password: "CQ174" },
  { username: "dr2025016", password: "SZ396" },
  { username: "dr2025017", password: "PH209" },
  { username: "dr2025018", password: "OV651" },
  { username: "dr2025019", password: "EY384" },
  { username: "dr2025020", password: "BJ972" },
  { username: "dr2025021", password: "LF103" },
  { username: "dr2025022", password: "KI854" },
  { username: "dr2025023", password: "MX427" },
  { username: "dr2025024", password: "HD769" },
  { username: "dr2025025", password: "QG295" },
  { username: "dr2025026", password: "RN618" },
  { username: "dr2025027", password: "ZW587" },
  { username: "dr2025028", password: "YS230" },
  { username: "dr2025029", password: "AJ953" },
  { username: "dr2025030", password: "UC467" },
  { username: "dr2025031", password: "TE982" },
  { username: "dr2025032", password: "BL719" },
  { username: "dr2025033", password: "VP306" },
  { username: "dr2025034", password: "OS840" },
  { username: "dr2025035", password: "XR594" },
  { username: "dr2025036", password: "DW718" },
  { username: "dr2025037", password: "MC285" },
  { username: "dr2025038", password: "HQ964" },
  { username: "dr2025039", password: "NY431" },
  { username: "dr2025040", password: "FB609" },
  { username: "dr2025041", password: "LS284" },
  { username: "dr2025042", password: "PU719" },
  { username: "dr2025043", password: "ZC517" },
  { username: "dr2025044", password: "KM402" },
  { username: "dr2025045", password: "YG835" },
  { username: "dr2025046", password: "AD790" },
  { username: "dr2025047", password: "RJ652" },
  { username: "dr2025048", password: "VH291" },
  { username: "dr2025049", password: "OE547" },
  { username: "dr2025050", password: "TI386" },
  { username: "dr2025051", password: "CN482" },
  { username: "dr2025052", password: "QZ178" },
  { username: "dr2025053", password: "WS690" },
  { username: "dr2025054", password: "ML520" },
  { username: "dr2025055", password: "PX947" },
  { username: "dr2025056", password: "FV613" },
  { username: "dr2025057", password: "GE294" },
  { username: "dr2025058", password: "BY740" },
  { username: "dr2025059", password: "HU835" },
  { username: "dr2025060", password: "AK507" },
  { username: "dr2025061", password: "XQ392" },
  { username: "dr2025062", password: "ZL681" },
  { username: "dr2025063", password: "DR158" },
  { username: "dr2025064", password: "OE473" },
  { username: "dr2025065", password: "SJ594" },
  { username: "dr2025066", password: "KF819" },
  { username: "dr2025067", password: "UL280" },
  { username: "dr2025068", password: "PQ967" },
  { username: "dr2025069", password: "VR136" },
  { username: "dr2025070", password: "NW548" },
  { username: "dr2025071", password: "HZ209" },
  { username: "dr2025072", password: "CG874" },
  { username: "dr2025073", password: "LB705" },
  { username: "dr2025074", password: "TP491" },
  { username: "dr2025075", password: "EJ602" },
  { username: "dr2025076", password: "MY253" },
  { username: "dr2025077", password: "FS980" },
  { username: "dr2025078", password: "QO178" },
  { username: "dr2025079", password: "VK320" },
  { username: "dr2025080", password: "AI695" },
  { username: "dr2025081", password: "ZR586" },
  { username: "dr2025082", password: "DY403" },
  { username: "dr2025083", password: "GW217" },
  { username: "dr2025084", password: "XT950" },
  { username: "dr2025085", password: "JE184" },
  { username: "dr2025086", password: "UC729" },
  { username: "dr2025087", password: "PM604" },
  { username: "dr2025088", password: "KV315" },
  { username: "dr2025089", password: "RX890" },
  { username: "dr2025090", password: "BQ278" },
  { username: "dr2025091", password: "NH542" },
  { username: "dr2025092", password: "LV631" },
  { username: "dr2025093", password: "SW907" },
  { username: "dr2025094", password: "EA756" },
  { username: "dr2025095", password: "YM428" },
  { username: "dr2025096", password: "ZT903" },
  { username: "dr2025097", password: "DG547" },
  { username: "dr2025098", password: "KU362" },
  { username: "dr2025099", password: "HP690" },
  { username: "dr2025100", password: "OF284" }
];

// 2) Ù…ØµØ§Ø¯Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…Ø­Ù„ÙŠØ©: video1.mp4 â€¦ video20.mp4 Ø¯Ø§Ø®Ù„ Ù…Ø¬Ù„Ø¯ /videos
const videoFiles = Array.from({length:20}, (_,i)=> `videos/video${i+1}.mp4`);

/* ======================== Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù„Ø³Ø© ======================== */
let currentUser = null;
let okUntil = 0;            // Ù†Ø§ÙØ°Ø© Ø³Ù…Ø§Ø­ Ù„Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
let suppressOnce = false;   // ØªØ¬Ø§Ù‡Ù„ blur/hidden Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¨Ø¹Ø¯ ÙØ¹Ù„ Ù…Ø´Ø±ÙˆØ¹
const ANGRY = 'ğŸ˜¡ Ù…Ø­Ø§ÙˆÙ„Ø© ØºÙŠØ± Ù…Ø³Ù…ÙˆØ­ Ø¨Ù‡Ø§ â€” ØªÙ… Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ø¬Ù„Ø³Ø© ÙÙˆØ±Ù‹Ø§.';

const qs = (s,p=document)=>p.querySelector(s);
const qsa = (s,p=document)=>[...p.querySelectorAll(s)];

function showToast(msg){ const t=qs('#toast'); t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'), 2100); }

/* ======================== Ø³Ø§Ø¹Ø© Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† ======================== */
function tickClock(){
  try{
    const now = new Date();
    const fmt = new Intl.DateTimeFormat('ar-EG', { hour:'2-digit', minute:'2-digit', second:'2-digit', hour12:false, timeZone:'Africa/Cairo' });
    qs('#clock').textContent = fmt.format(now);
  }catch{
    qs('#clock').textContent = new Date().toLocaleTimeString();
  }
}
setInterval(tickClock, 1000); tickClock();

/* ======================== Ø¯Ø®ÙˆÙ„/Ø®Ø±ÙˆØ¬ ======================== */
function enterApp(){
  const g = qs('#gate');
  g.style.display = 'block';
  g.firstElementChild.style.animation = 'none'; void g.firstElementChild.offsetWidth;
  g.firstElementChild.style.animation = 'boom .9s ease-out forwards';
  setTimeout(()=>{
    qs('#login').style.display='none';
    const app=qs('#app'); app.style.display='block';
    requestAnimationFrame(()=>{ app.style.opacity=1; });
    showToast('ğŸ‰ ØªÙ… Ø§Ù„Ø¯Ø®ÙˆÙ„');
  }, 120);
}

function hardExit(reason){
  try{ sessionStorage.clear(); localStorage.clear(); }catch{}
  try{ console.clear(); }catch{}
  try{ document.body.innerHTML=''; }catch{}
  try{ window.stop(); }catch{}
  try{ location.replace('about:blank'); }catch{}
  try{ open('','_self'); close(); }catch{}
}

function forceLogout(msg){
  currentUser = null;
  try{ qs('#who').textContent=''; }catch{}
  const lock = qs('#lock'); qs('#lockMsg').textContent = msg || ANGRY; lock.style.display='grid';
  setTimeout(()=> hardExit(msg||ANGRY), 220);
}

qs('#loginBtn').addEventListener('click', ()=>{
  const u = qs('#u').value.trim();
  const p = qs('#p').value.trim();
  if(!u || !p){ qs('#err').textContent='Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ù…Ù„Ø©'; return; }
  if(!/^dr2025\d{3}$/i.test(u)){ qs('#err').textContent='ØµÙŠØºØ© Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† Ù…Ø«Ù„: dr2025001'; return; }
  if(!users.some(x=> x.username===u && x.password===p )){
    qs('#err').textContent='âŒ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©'; return;
  }
  qs('#err').textContent='';
  currentUser = u; qs('#who').textContent = `Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ ${u}`;
  renderVideos();
  enterApp();
});
qs('#clearBtn').addEventListener('click', ()=>{ qs('#u').value=''; qs('#p').value=''; qs('#err').textContent=''; });
qs('#logoutBtn').addEventListener('click', ()=> forceLogout('ğŸšª ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬'));
qs('#panicBtn').addEventListener('click', ()=> forceLogout('â›” ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© ÙŠØ¯ÙˆÙŠÙ‹Ø§'));
qs('#backBtn').addEventListener('click', ()=>{ try{ history.length>1 ? history.back() : location.replace('/'); }catch{ location.replace('/'); } });

/* ======================== ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ======================== */
function renderVideos(){
  const wrap = qs('#videos'); wrap.innerHTML='';
  videoFiles.forEach((src, idx)=>{
    const id = idx+1;
    const card = document.createElement('article'); card.className='vcard col';
    const tileBG = 'repeating-linear-gradient(45deg, transparent 0 160px, rgba(255,255,255,.9) 160px 161px), repeating-linear-gradient(-45deg, transparent 0 160px, rgba(255,255,255,.9) 160px 161px)';
    card.innerHTML = `
      <div class="vhead">
        <span>ğŸ¬ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ ${id}</span>
        <span style="color:var(--brand2);font-weight:900">ØªØ´ØºÙŠÙ„ ÙÙ‚Ø·</span>
      </div>
      <div class="vplayer js-vp">
        <div class="wm-tiles" style="background-image:${JSON.stringify(tileBG)}"></div>
        <div class="wm"><span class="tag" id="wm-${idx}">${currentUser||''}</span></div>
        <video class="video"
          preload="metadata"
          playsinline
          disablepictureinpicture
          controlslist="nodownload noplaybackrate noremoteplayback"
          src="${src}"></video>
        <div class="controls">
          <button class="cbtn play">â¯ ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù</button>
          <button class="cbtn back">âª -10Ø«</button>
          <button class="cbtn fwd">â© +10Ø«</button>
          <input class="range seek" type="range" min="0" max="100" value="0" step="0.1" />
          <span class="time t">00:00 / 00:00</span>
          <input class="range vol" type="range" min="0" max="1" value="1" step="0.01" style="max-width:140px" />
          <button class="cbtn fs">â›¶ Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©</button>
        </div>
      </div>`;
    wrap.appendChild(card);
    startFloatingWM(qs(`#wm-${idx}`));

    // Ø¶Ø¨Ø· Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ…
    const vp   = card.querySelector('.js-vp');
    const v    = card.querySelector('.video');
    const play = card.querySelector('.play');
    const back = card.querySelector('.back');
    const fwd  = card.querySelector('.fwd');
    const seek = card.querySelector('.seek');
    const vol  = card.querySelector('.vol');
    const tm   = card.querySelector('.t');
    const fs   = card.querySelector('.fs');

    // Ù†Ø§ÙØ°Ø© Ø³Ù…Ø§Ø­ Ø¹Ù†Ø¯ Ø£ÙŠ ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ/Ø§Ù„ØªØ­ÙƒÙ…
    ['pointerenter','touchstart','pointerdown','mousemove','click','play','pause','seeking','volumechange'].forEach(ev=>{
      vp.addEventListener(ev, ()=> allowVideoInteraction(2200), {passive:true});
      v.addEventListener(ev, ()=> allowVideoInteraction(2200), {passive:true});
    });

    // Ù…Ù†Ø¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠÙ…Ù†Ù‰ ÙÙˆÙ‚ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
    v.addEventListener('contextmenu', e=>{ e.preventDefault(); if(currentUser) forceLogout(ANGRY+' (ÙƒÙ„ÙŠÙƒ ÙŠÙ…ÙŠÙ† ÙÙŠØ¯ÙŠÙˆ)'); });

    // ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù
    play.addEventListener('click', ()=> v.paused ? v.play().catch(()=>{}) : v.pause());

    // ØªÙ‚Ø¯ÙŠÙ…/ØªØ±Ø¬ÙŠØ¹
    back.addEventListener('click', ()=>{ try{ v.currentTime = Math.max(0, v.currentTime-10); }catch{} });
    fwd .addEventListener('click', ()=>{ try{ v.currentTime = Math.min(v.duration||v.currentTime+10, v.currentTime+10); }catch{} });

    // Ù…Ø¤Ù‚Øª Ùˆ Seek
    function fmt(t){ if(!isFinite(t)) return '00:00'; const m = Math.floor(t/60); const s = Math.floor(t%60); return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; }
    v.addEventListener('timeupdate', ()=>{
      const val = (v.currentTime / (v.duration||1))*100;
      seek.value = isFinite(val) ? val : 0;
      tm.textContent = `${fmt(v.currentTime)} / ${fmt(v.duration||0)}`;
    });
    v.addEventListener('loadedmetadata', ()=>{ tm.textContent = `${fmt(0)} / ${fmt(v.duration||0)}`; });
    seek.addEventListener('input', ()=>{ try{ v.currentTime = (seek.value/100) * (v.duration||0); }catch{} });

    // ØµÙˆØª
    vol.addEventListener('input', ()=>{ v.volume = Number(vol.value||1); });

    // Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
    fs.addEventListener('click', ()=>{
      const el = v.closest('.vplayer');
      allowVideoInteraction(2600);
      if(!document.fullscreenElement){
        el.requestFullscreen?.().catch(()=>{});
      }else{
        document.exitFullscreen?.().catch(()=>{});
      }
    });

    // Ø¹Ù†Ø¯ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ (ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯)
    v.addEventListener('error', ()=>{
      const note = document.createElement('div');
      note.className='muted';
      note.style.cssText='padding:10px 12px;border-top:1px solid rgba(255,255,255,.08)';
      note.textContent=.';
      card.appendChild(note);
    });
  });
}

/* ======================== ÙˆÙˆØªØ§Ø±Ù…Ø§Ø±Ùƒ Ù…ØªØ­Ø±Ùƒ ======================== */
function startFloatingWM(el){
  if(!el) return;
  const parent = el.parentElement; // .wm
  const move = ()=>{
    const p = parent.getBoundingClientRect();
    const pad = 42;
    const x = Math.random() * Math.max(1,(p.width - pad*2)) + pad;
    const y = Math.random() * Math.max(1,(p.height - pad*2)) + pad;
    el.style.transform = `translate(${x}px, ${y}px)`;
    el.style.opacity = String(0.85 + Math.random()*0.12);
  };
  move();
  setInterval(move, 2000 + Math.random()*1200);
}

/* ======================== Ø­Ù…Ø§ÙŠØ© Ù…Ø´Ø¯Ø¯Ø© ======================== */
// Ù…Ù†Ø¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠÙ…Ù†Ù‰ Ø®Ø§Ø±Ø¬ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
document.addEventListener('contextmenu', (e)=>{ e.preventDefault(); if(currentUser) forceLogout(ANGRY + ' (ÙƒÙ„ÙŠÙƒ ÙŠÙ…ÙŠÙ†)'); return false; });

// Ù…Ù†Ø¹ Ø³Ø­Ø¨/Ø¥ÙÙ„Ø§Øª + ØªØ­Ø¯ÙŠØ¯/Ù†Ø³Ø®/Ù‚Øµ/Ù„ØµÙ‚
document.addEventListener('dragstart', e=> e.preventDefault());
['selectstart','copy','cut','paste'].forEach(ev=> document.addEventListener(ev, (e)=>{ e.preventDefault(); if(currentUser) forceLogout(ANGRY + ` (${ev})`); }));

// Ù…Ù†Ø¹ Ø§Ø®ØªØµØ§Ø±Ø§Øª + Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± + Ø·Ø¨Ø§Ø¹Ø© + PrintScreen (Ù‚Ø¯ Ù„Ø§ ÙŠÙØ±ØµØ¯ Ø¹Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ù…ØªØµÙØ­Ø§Øª)
document.addEventListener('keydown', (e)=>{
  const k = e.key; const ctrl = e.ctrlKey||e.metaKey; const sh=e.shiftKey;
  const bad =
    (ctrl && ['s','u','p','a','c','x'].includes(k.toLowerCase())) ||
    (ctrl && sh && ['i','j','c'].includes(k.toLowerCase())) ||
    k==='F12' || k==='PrintScreen' ||
    (e.metaKey && sh && ['3','4','5'].includes(k)); // Ù…Ø§Ùƒ Ø³ÙƒØ±ÙŠÙ† Ø´ÙˆØª
  if(bad){ e.preventDefault(); e.stopPropagation(); if(currentUser) forceLogout(ANGRY + ` (Ù…ÙØªØ§Ø­ ${k})`); }
}, true);
window.onbeforeprint = ()=>{ if(currentUser) forceLogout(ANGRY + ' (Ø·Ø¨Ø§Ø¹Ø©)') };

// ÙƒØ´Ù devtools (ØªÙ‚Ø±ÙŠØ¨ÙŠ)
let devCheck = setInterval(()=>{
  try{
    const bigGap = (window.outerWidth - window.innerWidth) > 160 || (window.outerHeight - window.innerHeight) > 160;
    if(bigGap && currentUser) return forceLogout(ANGRY + ' (DevTools)');
    const el = { get id(){ if(currentUser) forceLogout(ANGRY + ' (Console Open)'); } };
    console.log(el);
    let t = performance.now();
    for(let i=0;i<100000;i++){}
    if(performance.now()-t > 250 && currentUser) forceLogout(ANGRY + ' (Debug Slow)');
  }catch{}
}, 1500);

// Ù†Ø§ÙØ°Ø© Ø³Ù…Ø§Ø­ Ø¹Ù†Ø¯ ØªÙØ§Ø¹Ù„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
function allowVideoInteraction(ms=2200){
  okUntil = Date.now() + ms;
  suppressOnce = true;
}
function isSafeInteraction(){ return Date.now() < okUntil; }

// blur/visibilitychange/resize â€” Ø§Ù„Ø·Ø±Ø¯ ÙÙ‚Ø· Ø¥Ù† Ù…Ø§ÙƒØ§Ù†Ø´ ÙÙŠÙ‡ Ù†Ø§ÙØ°Ø© Ø³Ù…Ø§Ø­
document.addEventListener('visibilitychange', ()=>{
  if(!currentUser) return;
  if(document.hidden){
    if(suppressOnce){ suppressOnce=false; return; }
    if(!isSafeInteraction()) forceLogout(ANGRY + ' (Ø¥Ø®ÙØ§Ø¡ Ø§Ù„ØªØ¨ÙˆÙŠØ¨/ØªØµÙˆÙŠØ±)');
  }
});
window.addEventListener('blur', ()=>{ if(currentUser && !isSafeInteraction()) forceLogout(ANGRY + ' (ÙÙ‚Ø¯Ø§Ù† ØªØ±ÙƒÙŠØ²)'); });

let lastW = window.innerWidth, lastH = window.innerHeight;
window.addEventListener('resize', ()=>{
  if(!currentUser) return;
  const dw = Math.abs(window.innerWidth - lastW);
  const dh = Math.abs(window.innerHeight - lastH);
  lastW = window.innerWidth; lastH = window.innerHeight;
  if((dw>240 || dh>240) && !isSafeInteraction()) forceLogout(ANGRY + ' (ØªØ¨Ø¯ÙŠÙ„ Ø´Ø§Ø´Ø©/ØªØ³Ø¬ÙŠÙ„ Ù…Ø­ØªÙ…Ù„)');
});
document.addEventListener('fullscreenchange', ()=> allowVideoInteraction(2600));

/* ======================== Ù†Ø¬ÙˆÙ… Ø·Ø§ÙŠØ±Ø© (Canvas) ======================== */
(function stars(){
  const c = document.getElementById('stars');
  const ctx = c.getContext('2d');
  let w,h,stars=[];
  function resize(){ w= c.width = innerWidth; h= c.height = innerHeight; stars = Array.from({length:Math.min(250, Math.floor(w*h/8000))}, ()=>({
    x: Math.random()*w,
    y: Math.random()*h,
    z: Math.random()*1.5 + .2,
    r: Math.random()*1.8 + .2,
    o: Math.random()*.6 + .2
  })); }
  resize(); addEventListener('resize', resize);
  function frame(){
    ctx.clearRect(0,0,w,h);
    for(const s of stars){
      s.x += Math.sin(performance.now()/1200)*0.02 * s.z;
      s.y += 0.04*s.z;
      if(s.y>h) s.y = -5, s.x = Math.random()*w;
      ctx.globalAlpha = s.o;
      ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fillStyle='#7fc9ff'; ctx.fill();
    }
    requestAnimationFrame(frame);
  }
  frame();
})();

/* ======================== Ø±Ø³Ø§Ù„Ø© Ø¨Ø¯Ø¡ ======================== */
showToast('ğŸ”’ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù…Ø¤Ù…Ù‘Ù† â€” Ø£ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© Ù†Ø³Ø®/ØªØµÙˆÙŠØ± = Ø®Ø±ÙˆØ¬ ÙÙˆØ±ÙŠ');
</script>
</body>
</html>
